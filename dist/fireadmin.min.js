!function(a,b,c){function d(a,b){if("undefined"==typeof a||"string"!=typeof a)throw new Error("Url is required to use FireAdmin");return this.ref=new Firebase(a),this.fbUrl=a,this.appName=e(a),this}function e(a){return a.replace("https://","").replace(".firebaseio.com","")}function f(a,b,d,e){var f="http://localhost:4000",g=f+"/"+a;c.net.XhrIo.send(g,function(a){if(a.target.isComplete()&&a.target.isSuccess()){var b=a.target.getResponse();b?h(d,b):h(e,{code:"SERVER_ERROR"})}else h(e,a.target.getLastError())},"POST",b)}function g(a,b,d,e){var f=b.child("users").child(a.uid),g={role:10,provider:a.provider};"password"==a.provider?g.email=a.password.email:c.object.extend(g,a),b.child("users").orderByChild("email").equalTo(signupData.email).on("value",function(a){if(a.val()){var b={message:"This email has already been used to create an account",account:JSON.stringify(a.val()),status:"ACCOUNT_EXISTS"};h(e,b)}else f.once("value",function(a){null==a.val()||a.hasChild("sessions")?(g.createdAt=Firebase.ServerValue.TIMESTAMP,f.setWithPriority(g,g.email,function(b){b?h(e,{message:"Error creating user profile"}):h(d,a.val())})):h(e,a.val())})},function(a){h(e,a)})}function h(a,b){return a&&"function"==typeof a?b?a(b):a():void 0}function i(){{var b="2.1.2";j(a.Firebase.SDK_VERSION),j(b)}if("undefined"==typeof a.Firebase)throw new Error("Firebase is required to use FireAdmin")}function j(a){return a.replace(".","").replace(".","")}i(),c.require("goog.net.XhrIo"),c.require("goog.object"),a.Fireadmin=d,d.prototype.createObject=function(a,b,c,d){var e=this.ref.getAuth();e&&(b.author=e.uid),b.createdAt=Date.now(),this.ref.child(a).push(b,function(a){a?h(d,a):h(c,b)})},d.prototype.listByCurrentUser=function(a,b,c){var d=this.ref.getAuth();if(null!=d)this.child(a).orderByChild("author").equalTo(d.uid).on("value",function(a){h(b,a.val())},function(a){h(c,a)});else{var e={code:"INVALID_AUTH",message:"listByCurrentUser cannot load list without current user"};h(c,e)}},d.prototype.listByUid=function(a,b,c,d){this.fbRef(a).orderByChild("author").equalTo(b).on("value",function(a){h(c,a.val())},function(a){h(d,a)})},d.prototype.getObjectCount=function(a,b,c){this.fbRef(a).on("value",function(a){h(b,a.numChildren())},function(a){h(c,a)})},d.prototype.getUserCount=function(a,b){this.ref.child("users").on("value",function(b){h(a,b.numChildren())},function(a){h(b,a)})},d.prototype.getOnlineUserCount=function(a,b){this.ref.child("presence").on("value",function(b){h(a,b.numChildren())},function(a){h(b,a)})},d.prototype.uploadImage=function(a,b,c){var d=this,e={appName:d.appName,image:a};f("upload",e,function(a){if(a.hasOwnProperty("url")){var d={url:a.url};h(b,d)}else h(c,{code:"SERVER_ERROR"})},function(a){h(c,a)})},d.prototype.userSignup=function(a,b,c){var d=this;if("object"==typeof a&&a.hasOwnProperty("email")){if(!a.hasOwnProperty("password")&&a.password.length<=8)return h(c,{message:"A valid Password is required to signup."});d.createUser(a,function(e){null===e?d.emailAuth(a,function(a){g(a,d.ref,function(a){h(b,a)},function(a){h(c,a)})},function(a){h(c,a)}):h(c,e)})}else if("string"==typeof a||a.hasOwnProperty("type")){if("string"==typeof a)var e=a;else if(a.hasOwnProperty("type"))var e=a.type;d.authWithOAuthPopup(e,function(a,e){a?h(c,a):g(e,d.ref,function(a){h(b,a)},function(a){h(c,a)})})}},d.prototype.emailAuth=function(a,b,c){var d=this.ref;d.authWithPassword(a,function(a,e){null===a?(d.setupPresence(e.uid),h(b,e)):h(c,a)})},d.prototype.authWithOAuthPopup=function(a,b,c){var d=this.ref;d.authWithOAuthPopup(a,function(a,e){null===a?(d.setupPresence(e.uid),h(b,e)):h(c,a)})},d.prototype.githubAuth=function(a,b){this.ref;return this.authWithOAuthPopup("github",a,b)},d.prototype.googleAuth=function(a,b){this.ref;return this.authWithOAuthPopup("google",a,b)},d.prototype.twitterAuth=function(a,b){this.ref;return this.authWithOAuthPopup("twitter",a,b)},d.prototype.accountByUid=function(a,b,c){this.ref.child(a).on("value",function(a){h(b,a.val())},function(a){h(c,a)})},d.prototype.accountByEmail=function(a,b,c){a&&"string"==typeof a?this.ref.child("users").orderByChild("email").equalTo(a).on("value",function(a){h(b,a.val())},function(a){h(c,a)}):h(c)},d.prototype.setupPresence=function(a){{var b=this.ref,c=b.child(".info/connected"),d=b.child("presence").child(a),e=b.child("sessions"),f=(b.child("users").child(a),b.child("users").child(a).child("sessions"));f.child("past")}c.on("value",function(c){if(c.val()){var g=(b.onDisconnect(),e.push({began:Firebase.ServerValue.TIMESTAMP,user:a})),h=g.child("ended");h.onDisconnect().set(Firebase.ServerValue.TIMESTAMP);var i=f.child("current").push(g.key());i.onDisconnect().remove(),d.set(!0),d.onDisconnect().remove(),b.onAuth(function(a){a||(h.set(Firebase.ServerValue.TIMESTAMP),i.remove(),d.remove())})}})},d.prototype.fbRef=function(){var a=this.ref,b=Array.prototype.slice.call(arguments);return b.length&&(a=a.child(pathRef(b))),a}}(window,document,goog);